# 歷史記憶區和設定功能測試

## 功能概覽

### 1. 歷史記憶區

- **自動儲存**: 每次匯出記憶時自動儲存到本地
- **去重機制**: 相同內容只更新時間戳記，不重複儲存
- **排序顯示**: 按日期排序，最新的在前
- **互動功能**: 點擊載入、複製、刪除操作

### 2. 應用設定

- **自動提醒**: 記憶已滿時是否顯示模態窗
- **數量限制**: 設定最大歷史記錄數量
- **自動清理**: 自動清理超過限制的舊記錄
- **儲存監控**: 視覺化顯示儲存使用量

## 測試場景

### 歷史記憶區測試

#### 1. 基本儲存功能

**步驟**:

1. 在 ChatGPT 網站匯出記憶
2. 點擊歷史按鈕查看歷史記憶區
3. 驗證記錄是否正確儲存

**預期結果**:

- 歷史記錄顯示正確的日期和時間
- 使用量和數量統計正確
- 內容預覽顯示前 100 字元

#### 2. 去重機制測試

**步驟**:

1. 匯出相同的記憶內容兩次
2. 檢查歷史記錄數量

**預期結果**:

- 只有一筆記錄
- 時間戳記更新為最新的匯出時間

#### 3. 互動功能測試

**步驟**:

1. 點擊歷史記錄項目
2. 使用複製按鈕
3. 使用刪除按鈕

**預期結果**:

- 點擊載入記錄到當前會話
- 複製功能正常工作
- 刪除後記錄消失

### 應用設定測試

#### 1. 自動提醒設定

**步驟**:

1. 開啟應用設定
2. 切換自動提醒開關
3. 在記憶已滿時測試

**預期結果**:

- 開啟時顯示模態窗提醒
- 關閉時不顯示模態窗

#### 2. 歷史數量限制

**步驟**:

1. 設定歷史記錄數量為 20 筆
2. 匯出超過 20 筆記憶
3. 檢查歷史記錄數量

**預期結果**:

- 只保留最新的 20 筆記錄
- 舊記錄自動清理

#### 3. 儲存使用量顯示

**步驟**:

1. 查看設定區的儲存使用量
2. 匯出多筆記憶後再次查看

**預期結果**:

- 使用量百分比正確顯示
- 進度條顏色根據使用量變化

### 模態窗提醒測試

#### 1. 自動顯示測試

**步驟**:

1. 確保自動提醒設定為開啟
2. 在 ChatGPT 中觸發記憶已滿狀態

**預期結果**:

- 自動顯示精美的提醒模態窗
- 包含警告圖標和說明文字
- 提供「稍後處理」和「立即匯出」選項

#### 2. 立即匯出功能

**步驟**:

1. 在模態窗中點擊「立即匯出」
2. 等待匯出完成

**預期結果**:

- 模態窗關閉
- 自動執行匯出流程
- 記錄儲存到歷史

## 技術驗證

### Chrome Storage API 使用

```javascript
// 驗證儲存功能
chrome.storage.local.get(['memoryHistory', 'settings'], result => {
  console.log('歷史記錄:', result.memoryHistory);
  console.log('設定:', result.settings);
});

// 驗證儲存使用量
chrome.storage.local.getBytesInUse(bytes => {
  console.log('使用量:', bytes, 'bytes');
});
```

### 資料結構驗證

```javascript
// 歷史記錄項目結構
{
  id: "unique_id",
  timestamp: "2024-01-01T12:00:00.000Z",
  date: "2024/1/1",
  time: "12:00",
  content: "# 儲存的記憶\n...",
  usage: "85%",
  count: 42,
  hash: "content_hash"
}

// 設定結構
{
  autoShowModal: true,
  maxHistoryItems: 50,
  autoCleanup: true
}
```

## 效能考量

### 儲存限制

- Chrome Storage Local: 10MB 限制
- 單筆記錄大小: 建議不超過 100KB
- 最大記錄數量: 建議不超過 200 筆

### 最佳化策略

- 內容雜湊去重
- 自動清理舊記錄
- 分頁載入大量記錄
- 壓縮儲存內容

## 已知限制

1. **儲存空間**: 受 Chrome Storage API 10MB 限制
2. **同步功能**: 目前僅支援本地儲存，不支援跨裝置同步
3. **匯出格式**: 目前僅支援 Markdown 格式
4. **搜尋功能**: 暫不支援歷史記錄搜尋

## 未來改進

1. **搜尋和篩選**: 新增歷史記錄搜尋功能
2. **匯入匯出**: 支援歷史記錄的匯入匯出
3. **標籤系統**: 為歷史記錄添加標籤分類
4. **統計分析**: 提供記憶使用統計和分析
5. **雲端同步**: 支援跨裝置同步功能
